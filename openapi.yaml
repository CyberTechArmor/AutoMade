openapi: 3.1.0
info:
  title: AutoMade API
  description: |
    AutoMade is an AI-powered project discovery and management platform.

    ## Authentication
    The API uses JWT Bearer tokens for authentication. Most endpoints require authentication.

    ## Authorization
    Role-based access control (RBAC) with the following roles:
    - `super_admin` - Full access to all resources
    - `admin` - Administrative access
    - `manager` - Project management access
    - `client` - Client-level access

    ## Error Responses
    All errors follow a standard format with `code`, `message`, and optional `details`.
  version: 1.0.0
  contact:
    name: Fractionate LLC
  license:
    name: Proprietary

servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://api.automade.io/api
    description: Production server

tags:
  - name: Health
    description: Service health check endpoints
  - name: Auth
    description: Authentication and authorization endpoints
  - name: Clients
    description: Client organization management
  - name: Projects
    description: Project lifecycle management
  - name: Sessions
    description: Discovery session management
  - name: Providers
    description: Service provider configuration

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token

  schemas:
    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          example: VALIDATION_ERROR
        message:
          type: string
          example: Invalid request parameters
        details:
          type: object
          additionalProperties: true

    PaginationMeta:
      type: object
      required:
        - page
        - limit
        - total
        - totalPages
      properties:
        page:
          type: integer
          minimum: 1
        limit:
          type: integer
          minimum: 1
          maximum: 100
        total:
          type: integer
          minimum: 0
        totalPages:
          type: integer
          minimum: 0

    User:
      type: object
      required:
        - id
        - email
        - role
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        displayName:
          type: string
        role:
          type: string
          enum: [super_admin, admin, manager, client]
        mfaEnabled:
          type: boolean
        timezone:
          type: string
        avatarUrl:
          type: string
          format: uri
          nullable: true
        createdAt:
          type: string
          format: date-time

    AuthResponse:
      type: object
      required:
        - user
        - accessToken
        - refreshToken
        - expiresIn
      properties:
        user:
          $ref: '#/components/schemas/User'
        accessToken:
          type: string
        refreshToken:
          type: string
        expiresIn:
          type: integer
          description: Token expiration time in seconds

    MfaRequiredResponse:
      type: object
      required:
        - mfaRequired
        - mfaToken
        - user
      properties:
        mfaRequired:
          type: boolean
          const: true
        mfaToken:
          type: string
        user:
          type: object
          properties:
            id:
              type: string
              format: uuid
            email:
              type: string
              format: email

    Client:
      type: object
      required:
        - id
        - name
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
          nullable: true
        contactName:
          type: string
          nullable: true
        contactEmail:
          type: string
          format: email
          nullable: true
        contactPhone:
          type: string
          nullable: true
        website:
          type: string
          format: uri
          nullable: true
        industry:
          type: string
          nullable: true
        logoUrl:
          type: string
          format: uri
          nullable: true
        billingAddress:
          type: object
          nullable: true
          properties:
            street:
              type: string
            city:
              type: string
            state:
              type: string
            postalCode:
              type: string
            country:
              type: string
        notes:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ProjectStage:
      type: string
      enum: [discovery, proposal, contract, development, delivery, maintenance, closed]

    ProjectOverview:
      type: object
      properties:
        problem:
          type: string
        goals:
          type: array
          items:
            type: string
        nonGoals:
          type: array
          items:
            type: string
        constraints:
          type: array
          items:
            type: string
        successCriteria:
          type: array
          items:
            type: string

    Project:
      type: object
      required:
        - id
        - clientId
        - name
        - stage
        - actualHours
        - actualCost
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        clientId:
          type: string
          format: uuid
        name:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
          nullable: true
        stage:
          $ref: '#/components/schemas/ProjectStage'
        startDate:
          type: string
          format: date-time
          nullable: true
        targetDate:
          type: string
          format: date-time
          nullable: true
        completedDate:
          type: string
          format: date-time
          nullable: true
        repositoryUrl:
          type: string
          format: uri
          nullable: true
        documentationUrl:
          type: string
          format: uri
          nullable: true
        productionUrl:
          type: string
          format: uri
          nullable: true
        stagingUrl:
          type: string
          format: uri
          nullable: true
        estimatedHours:
          type: integer
          nullable: true
        actualHours:
          type: integer
          default: 0
        estimatedCost:
          type: number
          nullable: true
        actualCost:
          type: number
          default: 0
        overview:
          $ref: '#/components/schemas/ProjectOverview'
        tags:
          type: array
          items:
            type: string
        notes:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    SessionState:
      type: string
      enum: [scheduled, pending, in_progress, paused, completed, cancelled]

    SessionType:
      type: string
      enum: [voice, video, text, hybrid]

    SessionConfig:
      type: object
      properties:
        maxDuration:
          type: integer
          description: Maximum session duration in seconds
        recordingEnabled:
          type: boolean
        transcriptionEnabled:
          type: boolean
        llmModel:
          type: string
        voiceId:
          type: string

    SessionOutput:
      type: object
      properties:
        summary:
          type: string
        keyInsights:
          type: array
          items:
            type: string
        actionItems:
          type: array
          items:
            type: string
        nextSteps:
          type: array
          items:
            type: string

    Session:
      type: object
      required:
        - id
        - projectId
        - title
        - type
        - state
        - isAutonomous
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        title:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
          nullable: true
        type:
          $ref: '#/components/schemas/SessionType'
        state:
          $ref: '#/components/schemas/SessionState'
        scheduledAt:
          type: string
          format: date-time
          nullable: true
        startedAt:
          type: string
          format: date-time
          nullable: true
        endedAt:
          type: string
          format: date-time
          nullable: true
        duration:
          type: integer
          description: Session duration in seconds
          nullable: true
        facilitatorId:
          type: string
          format: uuid
          nullable: true
        isAutonomous:
          type: boolean
          description: Whether the session is AI-facilitated
        llmProvider:
          type: string
          nullable: true
        livekitRoom:
          type: string
          nullable: true
        recordingUrl:
          type: string
          format: uri
          nullable: true
        config:
          $ref: '#/components/schemas/SessionConfig'
        output:
          $ref: '#/components/schemas/SessionOutput'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    SessionTranscript:
      type: object
      required:
        - id
        - sessionId
        - speakerId
        - speakerType
        - content
        - timestampMs
        - flagged
        - createdAt
      properties:
        id:
          type: string
          format: uuid
        sessionId:
          type: string
          format: uuid
        speakerId:
          type: string
        speakerType:
          type: string
          enum: [human, llm]
        speakerName:
          type: string
          nullable: true
        content:
          type: string
        timestampMs:
          type: integer
        confidence:
          type: string
          nullable: true
        flagged:
          type: boolean
        flagReason:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time

    Provider:
      type: object
      required:
        - id
        - name
        - type
        - service
        - enabled
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
          enum: [llm, voice, video, storage, email]
        service:
          type: string
        enabled:
          type: boolean
        priority:
          type: integer
        rateLimit:
          type: integer
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

  parameters:
    PageParam:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
    LimitParam:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

  responses:
    BadRequest:
      description: Bad request - validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized - authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

paths:
  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Check if the service is running
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

  /auth/register:
    post:
      tags: [Auth]
      summary: Register new user
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
                displayName:
                  type: string
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/login:
    post:
      tags: [Auth]
      summary: User login
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Login successful or MFA required
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/AuthResponse'
                  - $ref: '#/components/schemas/MfaRequiredResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout user
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/me:
    get:
      tags: [Auth]
      summary: Get current user
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user info
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/change-password:
    post:
      tags: [Auth]
      summary: Change password
      operationId: changePassword
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                newPassword:
                  type: string
                  minLength: 8
      responses:
        '200':
          description: Password changed
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/mfa/setup:
    post:
      tags: [Auth]
      summary: Begin MFA setup
      operationId: setupMfa
      security:
        - bearerAuth: []
      responses:
        '200':
          description: MFA setup info
          content:
            application/json:
              schema:
                type: object
                properties:
                  secret:
                    type: string
                  qrCode:
                    type: string
                    description: Base64 encoded QR code image
                  uri:
                    type: string
                    format: uri
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/mfa/setup/complete:
    post:
      tags: [Auth]
      summary: Complete MFA setup
      operationId: completeMfaSetup
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - code
              properties:
                code:
                  type: string
                  pattern: '^\d{6}$'
      responses:
        '200':
          description: MFA enabled
          content:
            application/json:
              schema:
                type: object
                properties:
                  enabled:
                    type: boolean
                  backupCodes:
                    type: array
                    items:
                      type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/mfa/verify:
    post:
      tags: [Auth]
      summary: Verify MFA code during login
      operationId: verifyMfa
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mfaToken
                - code
              properties:
                mfaToken:
                  type: string
                code:
                  type: string
                  pattern: '^\d{6}$'
      responses:
        '200':
          description: MFA verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/mfa/backup:
    post:
      tags: [Auth]
      summary: Use backup code for MFA
      operationId: useMfaBackupCode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mfaToken
                - backupCode
              properties:
                mfaToken:
                  type: string
                backupCode:
                  type: string
      responses:
        '200':
          description: Backup code accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/mfa/disable:
    post:
      tags: [Auth]
      summary: Disable MFA
      operationId: disableMfa
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
      responses:
        '200':
          description: MFA disabled
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /clients:
    get:
      tags: [Clients]
      summary: List clients
      operationId: listClients
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: List of clients
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Client'
                  pagination:
                    $ref: '#/components/schemas/PaginationMeta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags: [Clients]
      summary: Create client
      operationId: createClient
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 255
                description:
                  type: string
                contactName:
                  type: string
                contactEmail:
                  type: string
                  format: email
                contactPhone:
                  type: string
                website:
                  type: string
                  format: uri
                industry:
                  type: string
                notes:
                  type: string
      responses:
        '201':
          description: Client created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Client'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /clients/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Clients]
      summary: Get client
      operationId: getClient
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Client details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Client'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags: [Clients]
      summary: Update client
      operationId: updateClient
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 255
                description:
                  type: string
                contactName:
                  type: string
                contactEmail:
                  type: string
                  format: email
                contactPhone:
                  type: string
                website:
                  type: string
                  format: uri
                industry:
                  type: string
                notes:
                  type: string
      responses:
        '200':
          description: Client updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Client'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Clients]
      summary: Delete client
      operationId: deleteClient
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Client deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /projects:
    get:
      tags: [Projects]
      summary: List projects
      operationId: listProjects
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: clientId
          in: query
          schema:
            type: string
            format: uuid
        - name: stage
          in: query
          schema:
            $ref: '#/components/schemas/ProjectStage'
      responses:
        '200':
          description: List of projects
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Project'
                  pagination:
                    $ref: '#/components/schemas/PaginationMeta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags: [Projects]
      summary: Create project
      operationId: createProject
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - clientId
                - name
              properties:
                clientId:
                  type: string
                  format: uuid
                name:
                  type: string
                  minLength: 1
                  maxLength: 255
                description:
                  type: string
                stage:
                  $ref: '#/components/schemas/ProjectStage'
                startDate:
                  type: string
                  format: date-time
                targetDate:
                  type: string
                  format: date-time
                repositoryUrl:
                  type: string
                  format: uri
                estimatedHours:
                  type: integer
                estimatedCost:
                  type: number
                tags:
                  type: array
                  items:
                    type: string
                notes:
                  type: string
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /projects/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Projects]
      summary: Get project
      operationId: getProject
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Project details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags: [Projects]
      summary: Update project
      operationId: updateProject
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                stage:
                  $ref: '#/components/schemas/ProjectStage'
                startDate:
                  type: string
                  format: date-time
                targetDate:
                  type: string
                  format: date-time
                completedDate:
                  type: string
                  format: date-time
                repositoryUrl:
                  type: string
                  format: uri
                documentationUrl:
                  type: string
                  format: uri
                productionUrl:
                  type: string
                  format: uri
                stagingUrl:
                  type: string
                  format: uri
                estimatedHours:
                  type: integer
                actualHours:
                  type: integer
                estimatedCost:
                  type: number
                actualCost:
                  type: number
                overview:
                  $ref: '#/components/schemas/ProjectOverview'
                tags:
                  type: array
                  items:
                    type: string
                notes:
                  type: string
      responses:
        '200':
          description: Project updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Projects]
      summary: Delete project
      operationId: deleteProject
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Project deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /sessions:
    get:
      tags: [Sessions]
      summary: List sessions
      operationId: listSessions
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
        - name: state
          in: query
          schema:
            $ref: '#/components/schemas/SessionState'
      responses:
        '200':
          description: List of sessions
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Session'
                  pagination:
                    $ref: '#/components/schemas/PaginationMeta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags: [Sessions]
      summary: Create session
      operationId: createSession
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - projectId
                - title
              properties:
                projectId:
                  type: string
                  format: uuid
                title:
                  type: string
                  minLength: 1
                  maxLength: 255
                description:
                  type: string
                type:
                  $ref: '#/components/schemas/SessionType'
                scheduledAt:
                  type: string
                  format: date-time
                isAutonomous:
                  type: boolean
                config:
                  $ref: '#/components/schemas/SessionConfig'
      responses:
        '201':
          description: Session created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /sessions/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Sessions]
      summary: Get session
      operationId: getSession
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Session details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags: [Sessions]
      summary: Update session
      operationId: updateSession
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                type:
                  $ref: '#/components/schemas/SessionType'
                state:
                  $ref: '#/components/schemas/SessionState'
                scheduledAt:
                  type: string
                  format: date-time
                config:
                  $ref: '#/components/schemas/SessionConfig'
                output:
                  $ref: '#/components/schemas/SessionOutput'
      responses:
        '200':
          description: Session updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /sessions/{id}/start:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    post:
      tags: [Sessions]
      summary: Start session
      operationId: startSession
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Session started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /sessions/{id}/end:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    post:
      tags: [Sessions]
      summary: End session
      operationId: endSession
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Session ended
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /sessions/{id}/transcripts:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Sessions]
      summary: Get session transcripts
      operationId: getSessionTranscripts
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Session transcripts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SessionTranscript'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags: [Sessions]
      summary: Add transcript entry
      operationId: addTranscript
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - speakerId
                - speakerType
                - content
                - timestampMs
              properties:
                speakerId:
                  type: string
                speakerType:
                  type: string
                  enum: [human, llm]
                speakerName:
                  type: string
                content:
                  type: string
                timestampMs:
                  type: integer
      responses:
        '201':
          description: Transcript added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionTranscript'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /sessions/{id}/message:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    post:
      tags: [Sessions]
      summary: Send message and get LLM response
      operationId: sendMessage
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
      responses:
        '200':
          description: LLM response
          content:
            application/json:
              schema:
                type: object
                properties:
                  role:
                    type: string
                    const: assistant
                  content:
                    type: string
                  transcript:
                    $ref: '#/components/schemas/SessionTranscript'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /sessions/{id}/summarize:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    post:
      tags: [Sessions]
      summary: Generate session summary
      operationId: summarizeSession
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Session summary generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /providers:
    get:
      tags: [Providers]
      summary: List providers
      operationId: listProviders
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: type
          in: query
          schema:
            type: string
            enum: [llm, voice, video, storage, email]
        - name: service
          in: query
          schema:
            type: string
        - name: enabled
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: List of providers
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Provider'
                  pagination:
                    $ref: '#/components/schemas/PaginationMeta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags: [Providers]
      summary: Create provider
      operationId: createProvider
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - type
                - service
                - credentials
              properties:
                name:
                  type: string
                type:
                  type: string
                  enum: [llm, voice, video, storage, email]
                service:
                  type: string
                credentials:
                  type: object
                enabled:
                  type: boolean
                priority:
                  type: integer
                rateLimit:
                  type: integer
      responses:
        '201':
          description: Provider created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Provider'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /providers/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Providers]
      summary: Get provider
      operationId: getProvider
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Provider details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Provider'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags: [Providers]
      summary: Update provider
      operationId: updateProvider
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                credentials:
                  type: object
                enabled:
                  type: boolean
                priority:
                  type: integer
                rateLimit:
                  type: integer
      responses:
        '200':
          description: Provider updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Provider'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Providers]
      summary: Delete provider
      operationId: deleteProvider
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Provider deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /providers/{id}/test:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    post:
      tags: [Providers]
      summary: Test provider connection
      operationId: testProvider
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Provider test result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
